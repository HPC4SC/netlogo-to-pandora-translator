patches-own
[
  vote
  total
]

to recolor-patch []
  ifelse vote = 0
    [ set pcolor green ]
    [ set pcolor blue ]
end

to setup []
  ask patches
    [ set vote 2
      recolor-patch ] ;; A comment
end

to go []
  let any-votes-changed? false
  ask patches
    [ let previous-vote vote
      if total > 5 [ set vote 1 ]
      if total < 3 [ set vote 0 ]
      if total = 4
        [ if change-vote-if-tied?
          [ set vote (1 - vote) ] ]
      if total = 5
        [ ifelse award-close-calls-to-loser?
          [ set vote 0 ]
          [ set vote 1 ] ]
      if total = 3
        [ ifelse award-close-calls-to-loser?
          [ set vote 1 ]
          [ set vote 0 ] ]
      if vote != previous-vote
        [ set any-votes-changed? true ]
      recolor-patch ]
end